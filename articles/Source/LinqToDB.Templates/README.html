<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>T4 Models | Linq To DB (aka linq2db) </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="T4 Models | Linq To DB (aka linq2db) ">
    <meta name="generator" content="docfx 2.37.1.0">
    
    <link rel="shortcut icon" href="../../../images/icon.ico">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../toc.html">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    <meta property="docfx:rel" content="../../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../images/icon.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="t4-models">T4 Models</h1>

<p>T4 models are used to generate POCO&#39;s C# code using your database structure.</p>
<h2 id="installation">Installation</h2>
<p>Firstly you should install one of tools packages into your project:</p>
<p><code>Install-Package linq2db.XXX</code></p>
<p>Where XXX is one of supported databases, for example:</p>
<p><code>Install-Package linq2db.SqlServer</code></p>
<p>This also will install needed linq2db packages:</p>
<ul>
<li>linq2db.t4models</li>
<li>linq2db </li>
</ul>
<p>But <strong>not</strong> data provider packages (install them only if needed to compile your project, T4 models ships it&#39;s own data provider assemblies).</p>
<h3 id="net-core-specific">.Net Core specific</h3>
<p>Because of .Net Core projects do not support NuGet content files all stuff is not copied into project&#39;s folder, so to run T4 templates you&#39;ll need:</p>
<ul>
<li>open <code>$(SolutionDir).tools\linq2db.t4models</code> in Explorer </li>
<li>copy <code>CopyMe.XXX.Core.tt.txt</code> to your project&#39;s folder or subfolder, then you should use it instead of <code>CopyMe.XXX.tt.txt</code></li>
</ul>
<h2 id="running">Running</h2>
<p>After package installing you will see new <code>LinqToDB.Templates</code> folder in your project, this folder contains all needed T4 stuff to generate your model. Also would be created new folder in tour solution: <code>$(SolutionDir).tools\linq2db.t4models</code>, it is used to store and link assemblies, needed for generation (linq2db.dll and data provider assemblies).</p>
<p>To create a data model template take a look at one of the CopyMe.XXX.tt.txt file in your LinqToDB.Templates project folder. Copy this file to needed project location and rename it, like <code>MyModel.tt</code></p>
<p>There are few main steps in this file:</p>
<ol>
<li>Configuring generation process (read below)</li>
<li>Loading metadata - this is a call to <code>LoadMatadata()</code> function - it connects to your database and fetches all needed metadata (table structure, views, and so on)</li>
<li>Customizing generation process (read below)</li>
<li>Calling <code>GenerateModel()</code> - this will run model generation </li>
</ol>
<h2 id="configuring-generation-process">Configuring generation process</h2>
<p>Use the following initialization <strong>before</strong> you call the <code>LoadMetadata()</code> method.</p>
<pre><code class="lang-c#">NamespaceName                 = &quot;DataModels&quot;;       // Namespace of the generated classes.

DataContextName               = null;               // DataContext class name. If null - database name + &quot;DB&quot;.
BaseDataContextClass          = null;               // Base DataContext class name. If null - LinqToDB.Data.DataConnection.
GenerateConstructors          = true;               // Enforce generating DataContext constructors.
DefaultConfiguration          = null;               // Defines default configuration for default DataContext constructor.

BaseEntityClass               = null;               // Base Entity class name. If null - none.
DatabaseName                  = null;               // Table database name - [Table(Database=&quot;DatabaseName&quot;)].
GenerateDatabaseName          = false;              // Always generate table database name, even though DatabaseName is null.
IncludeDefaultSchema          = true;               // Default schema name is generated - [Table(Database=&quot;Northwind&quot;, Schema=&quot;dbo&quot;, Name=&quot;Customers&quot;)]

OneToManyAssociationType      = &quot;IEnumerable&lt;{0}&gt;&quot;; // One To Many association type (for members only). Change it to &quot;List&lt;{0}&gt;&quot; if needed.
GenerateAssociations          = true;               // Enforce generating associations as type members.
GenerateBackReferences        = true;               // Enforce generating backreference associations (affects both members and extensions).
GenerateAssociationExtensions = false;              // Enforce generating associations as extension methods. NB: this option does not affect GenerateAssociations. This will require linq2db 1.9.0 and above

ReplaceSimilarTables          = true;               // Replaces stored procedure result class names with similar to existing table class names.
GenerateFindExtensions        = true;               // Generates find extension methods based on PKs information.
IsCompactColumns              = true;               // If true, column compact view.

PluralizeClassNames                 = false;   // If true, pluralizes table class names.
SingularizeClassNames               = true;    // If true, singularizes table class names.
PluralizeDataContextPropertyNames   = true;    // If true, pluralizes DataContext property names.
SingularizeDataContextPropertyNames = false;   // If true, singularizes DataContex pProperty names.

GenerateDataTypes                   = false;   // If true, generates the DataType/Length/Precision/Scale properties of the Column attribute (unless overriden by the properties below).
GenerateDataTypeProperty            = null;    // If true, generates the DataType property of the Column attribute. If false, excludes generation on the DataType property even if GenerateDataTypes == true.
GenerateLengthProperty              = null;    // If true, generates the Length property of the Column attribute. If false, excludes generation on the Length property even if GenerateDataTypes == true.
GeneratePrecisionProperty           = null;    // If true, generates the Precision property of the Column attribute. If false, excludes generation on the Precision property even if GenerateDataTypes == true.
GenerateScaleProperty               = null;    // If true, generates the Scale property of the Column attribute. If false, excludes generation on the Scale property even if GenerateDataTypes == true.
GenerateDbTypes                     = false;   // If true, generates the DbType property of the Column attribute.

GenerateObsoleteAttributeForAliases = false;   // If true, generates [Obsolete] attribute for aliases.
IsCompactColumnAliases              = true;    // If true, column alias compact view.

NormalizeNames                      = false;   // convert some_name to SomeName for types and members

GetSchemaOptions.ExcludedSchemas = new[] { &quot;TestUser&quot;, &quot;SYSSTAT&quot; }; // Defines excluded schemas.
GetSchemaOptions.IncludedSchemas = new[] { &quot;TestUser&quot;, &quot;SYS&quot; };     // Defines only included schemas.

GetSchemaOptions.ExcludedCatalogs = new[] { &quot;TestUser&quot;, &quot;SYSSTAT&quot; }; // Defines excluded catalogs.
GetSchemaOptions.IncludedCatalogs = new[] { &quot;TestUser&quot;, &quot;SYS&quot; };     // Defines only included catalogs.

GetSchemaOptions.GetAssociationMemberName = key =&gt; &quot;Association_&quot; + key.MemberName;     // Defines custom naming logic for generated associations.

// check GetSchemaOptions class for more options

Func&lt;string, bool, string&gt; ToValidName         = ToValidNameDefault;          // Defines function to convert names to valid (My_Table to MyTable) 
Func&lt;string, bool, string&gt; ConvertToCompilable = ConvertToCompilableDefault;  // Converts name to c# compatible. By default removes uncompatible symbols and converts result with ToValidName

Func&lt;ForeignKey, string&gt; GetAssociationExtensionSinglularName = GetAssociationExtensionSinglularNameDefault; // Gets singular method extension method name for association 
Func&lt;ForeignKey, string&gt; GetAssociationExtensionPluralName    = GetAssociationExtensionPluralNameDefault;    // Gets plural method extension method name for association 
</code></pre><h2 id="provider-specific-configurations">Provider specific configurations</h2>
<h3 id="sql-server">SQL Server</h3>
<pre><code class="lang-cs">bool GenerateSqlServerFreeText = true; // Defines wheather to generate extensions for Free Text search, or not
</code></pre><h3 id="postgresql">PostgreSQL</h3>
<pre><code class="lang-cs">bool GenerateCaseSensitiveNames = false; // Defines whether to generate case sensitive or insensitive names 
</code></pre><h3 id="sybase">Sybase</h3>
<pre><code class="lang-cs">bool GenerateSybaseSystemTables = false; // Defines whether to generate Sybase sysobjects tables or not
</code></pre><h2 id="customizing-generation-process">Customizing generation process</h2>
<p>Use the following code to modify your model <strong>before</strong> you call the <code>GenerateModel()</code> method.</p>
<pre><code class="lang-c#">GetTable(&quot;Person&quot;).TypeName  = &quot;MyName&quot;;                                            // Replaces table name.
GetTable(&quot;Person&quot;).BaseClass = &quot;PersonBase, IId&quot;;                                   // Set base class &amp; interface for type, null to reset 

GetColumn(&quot;Person&quot;, &quot;PersonID&quot;)    .MemberName   = &quot;ID&quot;;                            // Replaces column PersonID of Person table with ID.
GetColumn(&quot;Person&quot;, &quot;PasswordHash&quot;).SkipOnUpdate = true;                            // Set [Column(SkipOnUpdate=true)], same for other column options
GetColumn(&quot;Person&quot;, &quot;Gender&quot;)      .Type         = &quot;global::Model.Gender&quot;;          // Change column type

GetFK(&quot;Orders&quot;, &quot;FK_Orders_Customers&quot;).MemberName      = &quot;Customers&quot;;               // Replaces association name.
GetFK(&quot;Orders&quot;, &quot;FK_Orders_Customers&quot;).AssociationType = AssociationType.OneToMany; // Changes association type.

SetTable(string tableName,
    string TypeName = null,
    string DataContextPropertyName = null)

    .Column(string columnName, string MemberName = null, string Type = null, bool? IsNullable = null)
    .FK    (string fkName,     string MemberName = null, AssociationType? AssociationType = null)
    ;

Model.Usings.Add(&quot;MyNamespace&quot;); // Adds using of namespace.

// Replaces all the columns where name is &#39;TableName&#39; + &#39;ID&#39; with &#39;ID&#39;.
foreach (var t in Tables.Values)
    foreach (var c in t.Columns.Values)
        if (c.IsPrimaryKey &amp;&amp; c.MemberName == t.TypeName + &quot;ID&quot;)
            c.MemberName = &quot;ID&quot;;
</code></pre><h2 id="useful-members-and-data-structures">Useful members and data structures</h2>
<pre><code class="lang-c#">Dictionary&lt;string,Table&gt;     Tables     = new Dictionary&lt;string,Table&gt;    ();
Dictionary&lt;string,Procedure&gt; Procedures = new Dictionary&lt;string,Procedure&gt;();

Table      GetTable     (string name);
Procedure  GetProcedure (string name);
Column     GetColumn    (string tableName, string columnName);
ForeignKey GetFK        (string tableName, string fkName);
ForeignKey GetForeignKey(string tableName, string fkName);

public class Table
{
    public string Schema;
    public string TableName;
    public string DataContextPropertyName;
    public bool   IsView;
    public string Description;
    public string AliasPropertyName;
    public string AliasTypeName;
    public string TypeName;

    public Dictionary&lt;string,Column&gt;     Columns;
    public Dictionary&lt;string,ForeignKey&gt; ForeignKeys;
}

public partial class Column : Property
{
    public string    ColumnName; // Column name in database
    public bool      IsNullable;
    public bool      IsIdentity;
    public string    ColumnType; // Type of the column in database
    public DbType    DbType;
    public string    Description;
    public bool      IsPrimaryKey;
    public int       PrimaryKeyOrder;
    public bool      SkipOnUpdate;
    public bool      SkipOnInsert;
    public bool      IsDuplicateOrEmpty;
    public string    AliasName;
    public string    MemberName;
}

public enum AssociationType
{
    Auto,
    OneToOne,
    OneToMany,
    ManyToOne,
}

public partial class ForeignKey : Property
{
    public string           KeyName;
    public Table            OtherTable;
    public List&lt;Column&gt;     ThisColumns;
    public List&lt;Column&gt;     OtherColumns;
    public bool             CanBeNull;
    public ForeignKey       BackReference;
    public string           MemberName;
    public AssociationType  AssociationType;
}

public partial class Procedure : Method
{
    public string          Schema;
    public string          ProcedureName;
    public bool            IsFunction;
    public bool            IsTableFunction;
    public bool            IsDefaultSchema;

    public Table           ResultTable;
    public Exception       ResultException;
    public List&lt;Table&gt;     SimilarTables;
    public List&lt;Parameter&gt; ProcParameters;
}

public class Parameter
{
    public string   SchemaName;
    public string   SchemaType;
    public bool     IsIn;
    public bool     IsOut;
    public bool     IsResult;
    public int?     Size;
    public string   ParameterName;
    public string   ParameterType;
    public Type     SystemType;
    public string   DataType;
}
</code></pre></article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/linq2db/linq2db/blob/master/Source/LinqToDB.Templates/README.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            Copyright © 2011-2018 linq2db.com<br><br>Generated by <strong>DocFX</strong>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>

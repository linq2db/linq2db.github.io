<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Development rules and regulations, code style | Linq To DB (aka linq2db) </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Development rules and regulations, code style | Linq To DB (aka linq2db) ">
    <meta name="generator" content="docfx 2.27.0.0">
    
    <link rel="shortcut icon" href="../images/icon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    <meta property="docfx:rel" content="../">
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../images/icon.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items"></div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="contrib">
<h1 id="development-rules-and-regulations-code-style">Development rules and regulations, code style</h1>

<p>Follow this <a href="https://github.com/linq2db/linq2db/files/1056002/Development.rules.and.regulations.docx">document</a></p>
<h1 id="project-structure-description">Project structure description</h1>
<h2 id="linq2db">linq2db</h2>
<p>Solution and folder structure</p>
<pre><code>.\ //Root folder
.\Data // Contains fileserver databases and scripts for creating and initializing test databases
.\NuGet // Stuff for nuget package, readme.txt
.\Redist // Redistributable binaries unavailable in nugget
.\Source // Source
.\Tests // Unit tests stuff
.\Tests\FSharp // F# models and tests
.\Tests\Linq // All unit tests
.\Tests\Model // Models for tests
.\Tests\TestApp // Test application
.\Tests\Utils // Test helper and utilities application
.\Tests\VisualBasic //Visual Basic models and tests
</code></pre><p>Solutions:</p>
<ul>
<li><code>.\linq2db.sln</code> - VS2017 solution</li>
</ul>
<p>Projects:</p>
<table>
<thead>
<tr>
<th>Project</th>
<th style="text-align:center">.NET 4.0</th>
<th style="text-align:center">4.5</th>
<th style="text-align:center">4.51</th>
<th style="text-align:center">4.52</th>
<th style="text-align:center">.NET Standard 1.6</th>
<th style="text-align:center">2.0</th>
<th style="text-align:center">.NET Core 1.0</th>
<th style="text-align:center">2.0</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>.\Source\LinqToDB\LinqToDB.csproj</code></td>
<td style="text-align:center">√</td>
<td style="text-align:center">√</td>
<td style="text-align:center">√</td>
<td style="text-align:center"></td>
<td style="text-align:center">√</td>
<td style="text-align:center">√</td>
<td style="text-align:center"></td>
<td style="text-align:center">√</td>
</tr>
<tr>
<td><code>.\Tests\Linq\Tests.csproj</code></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">√</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">√</td>
<td style="text-align:center">√</td>
</tr>
<tr>
<td><code>.\Tests\FSharp\Tests.FSharp.fsproj</code></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">√</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td><code>.\Tests\Model\Tests.Model.csproj</code></td>
<td style="text-align:center"></td>
<td style="text-align:center">√</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">√</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td><code>.\Tests\Utils\Tests.Utils.csproj</code></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">√</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">√</td>
<td style="text-align:center">√</td>
</tr>
<tr>
<td><code>.\Tests\VisualBasic\Tests.VisualBasic.vbproj</code></td>
<td style="text-align:center"></td>
<td style="text-align:center">√</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">√</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<h2 id="building">Building</h2>
<p>You can use any solution for building and running tests. But you also should care about other supported platforms. To check if your changes have not affected other projects you can:</p>
<ul>
<li>run <code>.\Source\compile.cmd</code> - builds .Net 4, .Net 4.5, .Net WS</li>
<li>run <code>dotnet build</code> - in Root folder to build .Net Core </li>
</ul>
<h3 id="different-platforms-support">Different platforms support</h3>
<p>Because of compiling for different platforms we do use:</p>
<ul>
<li>Conditional compilation. Different projects and configurations define compilation symbols:<ul>
<li>FW4 - .Net 4.0 compatibility level</li>
<li>SILVERLIGHT - Silverlight compatibility level</li>
<li>NETFX_CORE - Windows Store 8 compatibility level</li>
<li>NOASYNC - async is not supported </li>
<li>NETSTANDARD - .Net Core (netstandard1.6) compatibility level</li>
<li>NOFSHARP - used by .Net Core test project to avoid compiling code dependent on F#</li>
</ul>
</li>
<li>Exclude files from build - some files are excluded from build in projects, corresponding to target framework</li>
<li>Implementing missing classes and enums. There are some under <code>.\Source\Compatibility</code> folder.</li>
</ul>
<h2 id="run-tests">Run tests</h2>
<p>NUnit3 is used as unit testing framework. Most tests are run for all supported databases, and written in same pattern:</p>
<pre><code class="lang-cs">[TestFixture]
public class Test: TestBase // TestBase - base class, provides base methods and object data sources
{
    // DataContextSourceAttribute - implements Nunit ITestBuilder and provides context values to test
    [DataContextSource]
    public void Test(string context)
    {
        // TestBase.GetDataContext - creates new IDataContext, supports creating WCF client and server
        using(var db = GetDataContext(context))
        {
            // Here is the most interesting
            // this.Person - list of persons, corresponding Person table in database (derived from TestBase)
            // db.Person - database table
            // So test checks that LINQ to Objects query produces the same result as executed database query
            AreEqual(this.Person.Where(_ =&gt; _.Name == &quot;John&quot;), db.Person.Where(_ =&gt; _.Name == &quot;John&quot;));
        }
    }

}
</code></pre><h3 id="configure-data-providers-for-tests">Configure data providers for tests</h3>
<p><code>DataContextSourceAttribute</code> generates tests for each configured data provider, configuration is taken:</p>
<ol>
<li>From <code>.\Tests\Linq\UserDataProviders.txt</code> (if any) (UserDataProviders.Core.txt for .Net Core)</li>
<li>From <code>.\Tests\Linq\DefaultDataProviders.txt</code> (DefaultDataProviders.Core.txt for .Net Core)</li>
</ol>
<p>All default connection strings are stored in <code>.\Tests\Linq\app.config</code>
<code>DataProviders.txt</code> structure is:
<code>[!]ConfigurationName[* ConnectionString][* DataProviderName]</code></p>
<ul>
<li><code>[]</code> - optional parts</li>
<li><code>*</code> - is used as field delimiter</li>
<li><code>--</code> - is used to comment line</li>
</ul>
<p>Parts:</p>
<ul>
<li><code>!</code> - means that this configuration is used as <code>DataConnection.DefaultConfiguration</code></li>
<li><code>ConfigurationName</code> - configuration name (passed to test as <code>context</code> parameter)</li>
<li>ConnectionString - used to override default connection string from <code>app.config</code></li>
<li>DataProviderName - used to define DataProvider for configuration</li>
</ul>
<p><strong>UserDataProviders.txt example</strong></p>
<pre><code>-- this is comment line and would be ignored
Access
!SQLiteMs       * Data Source=Database\TestData.sqlite      * SQLite
</code></pre><p>this does mean:</p>
<ul>
<li>Run tests for <code>Access</code> configuration with default settings</li>
<li>Run tests for <code>SQLiteMs</code> configuration. This configuration is used as default, with connection string <code>Data Source=Database\TestData.sqlite</code> and <code>SQLite</code> data provider.</li>
</ul>
<p>More examples are below in CI section.</p>
<p>So tests are done only for providers defined in <code>DataProviders.txt</code>, defaults are in <code>DefaultDataProviders.txt</code> (they are Access, SQL CE, SQLite - all file server databases). To define your own configurations <strong>DO NOT EDIT</strong> <code>DefaultDataProviders.txt</code> - create <code>.\Tests\Linq\UserDataProviders.txt</code> and define needed configurations. </p>
<p>When all tests are executed, first <code>_CreateData</code> tests will be run - those execute SQL scripts and insert default data to database, so if you are going to run one test be sure to run <code>_CreateData</code> before it manually.</p>
<p>Also - if your test changes database data, be sure to revert those changes (!) to avoid side effects for other tests.</p>
<h2 id="continuous-integration">Continuous Integration</h2>
<p>We do run builds and tests with:</p>
<ul>
<li><a href="https://ci.appveyor.com/project/igor-tkachev/linq2db">AppVeyor</a> (Windows) <a href="https://github.com/linq2db/linq2db/blob/master/appveyor.yml">appveyor.yml</a>. Makes build and runs tests for:<ul>
<li>.Net 4.5: <a href="https://github.com/linq2db/linq2db/blob/master/Tests/Linq/AppveyorDataProviders.txt">AppveyorDataProviders.txt</a></li>
<li>.Net Core: <a href="https://github.com/linq2db/linq2db/blob/master/Tests/Linq/AppveyorDataProviders.Core.txt">AppveyorDataProviders.Core.txt</a></li>
</ul>
</li>
<li><a href="https://travis-ci.org/linq2db/linq2db">Travis</a> (Linux) <a href="https://github.com/linq2db/linq2db/blob/master/.travis.yml">.travis.yml</a>. Makes build and runs tests for:<ul>
<li>Mono: <a href="https://github.com/linq2db/linq2db/blob/master/Tests/Linq/TravisDataProviders.txt">TravisDataProviders.txt</a></li>
<li>.Net Core: <a href="https://github.com/linq2db/linq2db/blob/master/Tests/Linq/TravisDataProviders.Core.txt">TravisDataProviders.Core.txt</a></li>
</ul>
</li>
</ul>
<p><code>xxxDataproviders</code> files are renamed by CI to <code>UserDataProviders</code> before running tests.</p>
<h3 id="skip-ci-build">Skip CI build</h3>
<p>If you want to skip building commit by CI (for example you have changed *.md files only) begin commit comment with <code>[ci skip]</code>.</p>
<h3 id="publishing-packages">Publishing packages</h3>
<ul>
<li><strong>Release candidate</strong> packages are published by AppVeyor to <a href="https://github.com/linq2db/linq2db#feeds">MyGet.org</a> for each successful build of <strong>master</strong> branch. </li>
<li><strong>Release</strong> packages are published by AppVeyor to <a href="https://github.com/linq2db/linq2db#feeds">NuGet.org</a> for each successful build of <strong>release</strong> branch. </li>
</ul>
<h2 id="building-releases">Building releases</h2>
<ol>
<li>Update <code>.\NuGet\Readme.txt</code> file (append release notes)</li>
<li>Create PR from <code>master</code> to <code>release</code> branch, in comments add <a href="https://github.com/linq2db/linq2db/wiki/How-can-i-help#testing-how-to">@testers</a> to notify all testers that we are ready to release</li>
<li>Wait few days for feedback from testers and approval from contributors</li>
<li>Merge PR</li>
<li><a href="https://github.com/linq2db/linq2db/releases">Tag release</a></li>
<li>Update versions in <code>master</code> branch (this will lead to publish all next <code>master</code> builds as new version RC):<ul>
<li>in <a href="https://github.com/linq2db/linq2db/blob/master/appveyor.yml">.\appveyor.yml</a> set <code>packageVersion</code> parameter</li>
<li>in <a href="https://github.com/linq2db/linq2db/blob/master/Source/project.json">.\Source\project.json</a> set new <code>version</code> parameter</li>
<li>in <a href="https://github.com/linq2db/linq2db/blob/master/Source/Properties/LinqToDBConstants.cs">.\Source\Properties\LinqToDBConstants.cs</a> set <code>FullVersionString</code> constant.</li>
</ul>
</li>
</ol>
<h2 id="process">Process</h2>
<p>In general you should follow simple rules:</p>
<ul>
<li>Development rules and regulations, code style</li>
<li>Do not add new features without tests</li>
<li>Avoid direct pushes to <code>master</code> and <code>release</code> branches</li>
<li>To fix some issue or implement new feature create new branch and make pull request after you are ready to merge. Merge your PR only after contributor&#39;s review.</li>
<li>If you are going to implement any big feature you may want other contributors to participate (coding, code review, feature discuss and so on), so to do it:<ul>
<li>Create new PR with <strong>[WIP]</strong> prefix (Work In Process)</li>
<li>After you are ready to merge remove the prefix &amp; assign contributors as reviewers</li>
</ul>
</li>
<li>If you wo have wright access, it is recommended to use central repository (not forks). Why - simple, it would allow other teammates to help you in developing (if needed). Certainly you are free to use fork if it is more convenient to you</li>
<li>Please avoid adding new public classes, properties, methods without XML doc</li>
<li>Read issues and help users</li>
<li>Do not EF :)</li>
</ul>
<h1 id="see-also">See also</h1>
<ul>
<li><a class="xref" href="Issue-reporting.html">Issue reporting</a></li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/linq2db/linq2db/blob/master/doc/articles/contrib.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            Copyright © 2015-2017 linq2db.com
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>

<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>LINQ to DB | Linq To DB (aka linq2db) </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="LINQ to DB | Linq To DB (aka linq2db) ">
    <meta name="generator" content="docfx 2.56.7.0">
    
    <link rel="shortcut icon" href="images/icon.ico">
    <link rel="stylesheet" href="styles/docfx.vendor.css">
    <link rel="stylesheet" href="styles/docfx.css">
    <link rel="stylesheet" href="styles/main.css">
    <meta property="docfx:navrel" content="toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    <meta property="docfx:rel" content="">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="index.html">
                <img id="logo" class="svg" src="images/icon.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h2 id="linq-to-db">LINQ to DB</h2>

<p><a href="https://dotnetfoundation.org/projects/linq2db">
<img align="right" alt=".NET Foundation Logo" src="https://raw.githubusercontent.com/dotnet-foundation/swag/master/logo/dotnetfoundation_v4_horizontal.png" width="250px"></a></p>
<p><a href="https://www.nuget.org/profiles/LinqToDB"><img src="https://buildstats.info/nuget/linq2db?includePreReleases=true" alt="NuGet Version and Downloads count"></a> <a href="../submodules/linq2db/MIT-LICENSE.txt"><img src="https://img.shields.io/github/license/linq2db/linq2db" alt="License"></a></p>
<p><a href="https://dev.azure.com/linq2db/linq2db/_build?definitionId=5&amp;_a=summary"><img src="https://img.shields.io/azure-devops/build/linq2db/linq2db/5/master?label=build%20(master)" alt="Master branch build"></a> <a href="https://dev.azure.com/linq2db/linq2db/_build?definitionId=5&amp;_a=summary"><img src="https://img.shields.io/azure-devops/build/linq2db/linq2db/5?label=build%20(latest)" alt="Latest build"></a></p>
<p><a href="https://stackoverflow.com/questions/tagged/linq2db"><img src="https://img.shields.io/stackexchange/stackoverflow/t/linq2db.svg?label=stackoverflow" alt="StackOverflow questions"></a> <a href="https://twitter.com/linq2db"><img src="https://img.shields.io/twitter/follow/linq2db.svg" alt="Follow @linq2db"></a> <a href="https://github.com/linq2db/linq2db/issues?q=is%3Aopen+is%3Aissue+label%3A%22good+first+issue%22"><img src="https://img.shields.io/github/issues/linq2db/linq2db/good%20first%20issue.svg" alt="&quot;good first issue&quot; tasks"></a></p>
<p>LINQ to DB is the fastest LINQ database access library offering a simple, light, fast, and type-safe layer between your POCO objects and your database. </p>
<p>Architecturally it is one step above micro-ORMs like Dapper, Massive, or PetaPoco, in that you work with LINQ expressions, not with magic strings, while maintaining a thin abstraction layer between your code and the database. Your queries are checked by the C# compiler and allow for easy refactoring.</p>
<p>However, it&#39;s not as heavy as LINQ to SQL or Entity Framework. There is no change-tracking, so you have to manage that yourself, but on the positive side you get more control and faster access to your data.</p>
<p>In other words <strong>LINQ to DB is type-safe SQL</strong>.</p>
<p>linq2db is a <a href="https://dotnetfoundation.org/">.NET Foundation</a> project.</p>
<p>Development version nuget <a href="https://pkgs.dev.azure.com/linq2db/linq2db/_packaging/linq2db/nuget/v3/index.json">feed</a> (<a href="https://docs.microsoft.com/en-us/nuget/consume-packages/install-use-packages-visual-studio#package-sources">how to use</a>)</p>
<h2 id="standout-features">Standout Features</h2>
<ul>
<li>Rich Querying API:<ul>
<li><a href="https://linq2db.github.io/articles/sql/Join-Operators.html">Explicit Join Syntax</a> (In addition to standard LINQ join syntax.)</li>
<li><a href="https://linq2db.github.io/articles/sql/CTE.html">CTE Support</a></li>
<li><a href="https://linq2db.github.io/articles/sql/Bulk-Copy.html">Bulk Copy/Insert</a></li>
<li><a href="https://linq2db.github.io/articles/sql/Window-Functions-%28Analytic-Functions%29.html">Window/Analytic Functions</a></li>
<li><a href="https://linq2db.github.io/articles/sql/merge/Merge-API-Description.html">Merge API</a></li>
</ul>
</li>
<li>Extensibility:<ul>
<li><a href="https://github.com/linq2db/linq2db/tree/master/Source/LinqToDB/Sql/">Ability to Map Custom SQL to Static Functions</a></li>
</ul>
</li>
</ul>
<p>Visit our <a href="http://blog.linq2db.com/">blog</a> and see <a href="https://linq2db.github.io/index.html">Github.io documentation</a> for more details.</p>
<p>Code examples and demos can be found <a href="https://github.com/linq2db/examples">here</a> or in <a href="https://github.com/linq2db/linq2db/tree/master/Tests/Linq">tests</a>.</p>
<p><a href="https://github.com/linq2db/linq2db/wiki/Releases-and-Roadmap">Release Notes</a> page.</p>
<h3 id="related-linq2db-and-3rd-party-projects">Related linq2db and 3rd-party projects</h3>
<ul>
<li><a href="https://github.com/linq2db/linq2db.EntityFrameworkCore">linq2db.EntityFrameworkCore</a> (adds support for linq2db functionality in EF.Core projects)</li>
<li><a href="https://github.com/linq2db/linq2db.LINQPad">LINQPad Driver</a></li>
<li><a href="https://github.com/LinqToDB4iSeries/Linq2DB4iSeries">DB2 iSeries Provider</a></li>
<li><a href="https://github.com/David-Mawer/LINQ2DB-MVC-Core-2/tree/master/LINQ2DB-MVC-Core-2">ASP.NET CORE 2 Template</a></li>
<li><a href="https://github.com/David-Mawer/LINQ2DB-AngularWebApp-Core-3">ASP.NET CORE 3 Template with Angular</a></li>
<li><a href="https://github.com/David-Mawer/LINQ2DB-MVC-Core-5">ASP.NET CORE 5 Template</a></li>
<li><a href="https://github.com/apdevelop/linq2db-postgis-extensions">PostGIS extensions for linq2db</a></li>
</ul>
<p>Notable open-source users:</p>
<ul>
<li><a href="https://github.com/nopSolutions/nopCommerce">nopCommerce</a> (starting from v4.30) - popular open-source e-commerce solution</li>
<li><a href="https://github.com/voronov-maxim/OdataToEntity">OdataToEntity</a> - library to create OData service from database context</li>
<li><a href="https://github.com/sunengine/SunEngine">SunEngine</a> - site, blog and forum engine</li>
</ul>
<p>Unmantained projects:</p>
<ul>
<li><a href="https://github.com/linq2db/LinqToDB.Identity">LinqToDB.Identity</a> - ASP.NET Core Identity provider using linq2db</li>
<li><a href="https://github.com/linq2db/IdentityServer4.LinqToDB">IdentityServer4.LinqToDB</a> - IdentityServer4 persistence layer using linq2db</li>
</ul>
<h2 id="how-to-help-the-project">How to help the project</h2>
<p>No, this is not the donate link. We do need something really more valuable - your <strong>time</strong>. If you really want to help us please read this <a href="https://linq2db.github.io/articles/project/How-can-i-help.html">post</a>.</p>
<h2 id="lets-get-started">Let&#39;s get started</h2>
<p>From <strong>NuGet</strong>:</p>
<ul>
<li><code>Install-Package linq2db</code></li>
</ul>
<h2 id="configuring-connection-strings">Configuring connection strings</h2>
<h3 id="using-connection-options-builder">Using Connection Options Builder</h3>
<p>You can configure connection options from code using <a href="https://linq2db.github.io/api/LinqToDB.Configuration.LinqToDbConnectionOptionsBuilder.html"><code>LinqToDbConnectionOptionsBuilder</code></a> class (check class for available options):</p>
<pre><code class="lang-cs">// create options builder
var builder = new LinqToDbConnectionOptionsBuilder();

// configure connection string
builder.UseSqlServer(connectionString);

// or using custom connection factory
b.UseConnectionFactory(
    SqlServerTools.GetDataProvider(
        SqlServerVersion.v2017,
        SqlServerProvider.MicrosoftDataSqlClient),
    () =&gt;
    {
        var cn = new SqlConnection(connectionString);
        cn.AccessToken = accessToken;
        return cn;
    });

// pass configured options to data connection constructor
var dc = new DataConnection(builder.Build());
</code></pre><h3 id="using-config-file-net-framework">Using Config File (.NET Framework)</h3>
<p>In your <code>web.config</code> or <code>app.config</code> make sure you have a connection string (check <a href="https://github.com/linq2db/linq2db/blob/master/Source/LinqToDB/ProviderName.cs">this file</a> for supported providers):</p>
<pre><code class="lang-xml">&lt;connectionStrings&gt;
  &lt;add name=&quot;Northwind&quot; 
    connectionString = &quot;Server=.\;Database=Northwind;Trusted_Connection=True;Enlist=False;&quot; 
    providerName     = &quot;SqlServer&quot; /&gt;
&lt;/connectionStrings&gt;
</code></pre><h3 id="using-connection-string-settings-provider">Using Connection String Settings Provider</h3>
<p>.Net Core does not support <code>System.Configuration</code> until 3.0 so to configure connection strings you should implement <code>ILinqToDBSettings</code>, for example:</p>
<pre><code class="lang-cs">public class ConnectionStringSettings : IConnectionStringSettings
{
    public string ConnectionString { get; set; }
    public string Name { get; set; }
    public string ProviderName { get; set; }
    public bool IsGlobal =&gt; false;
}

public class MySettings : ILinqToDBSettings
{
    public IEnumerable&lt;IDataProviderSettings&gt; DataProviders =&gt; Enumerable.Empty&lt;IDataProviderSettings&gt;();

    public string DefaultConfiguration =&gt; &quot;SqlServer&quot;;
    public string DefaultDataProvider =&gt; &quot;SqlServer&quot;;

    public IEnumerable&lt;IConnectionStringSettings&gt; ConnectionStrings
    {
        get
        {
            yield return
                new ConnectionStringSettings
                {
                    Name = &quot;Northwind&quot;,
                    ProviderName = &quot;SqlServer&quot;,
                    ConnectionString = @&quot;Server=.\;Database=Northwind;Trusted_Connection=True;Enlist=False;&quot;
                };
        }
    }
}
</code></pre><p>And later just set on program startup before the first query is done (Startup.cs for example):</p>
<pre><code class="lang-cs">DataConnection.DefaultSettings = new MySettings();
</code></pre><h3 id="aspnet-core">ASP.NET Core</h3>
<p>See <a href="https://linq2db.github.io/articles/get-started/asp-dotnet-core/index.html">article</a>.</p>
<h2 id="now-lets-create-a-poco-class">Now let&#39;s create a <strong>POCO</strong> class</h2>
<p>Important: you also can generate those classes from your database using <a href="https://linq2db.github.io/articles/T4.html">T4 templates</a>. Demonstration video could be found <a href="https://linq2db.github.io/articles/general/Video.html">here</a>.</p>
<pre><code class="lang-c#">using System;
using LinqToDB.Mapping;

[Table(Name = &quot;Products&quot;)]
public class Product
{
  [PrimaryKey, Identity]
  public int ProductID { get; set; }

  [Column(Name = &quot;ProductName&quot;), NotNull]
  public string Name { get; set; }

  // ... other columns ...
}
</code></pre><p>At this point LINQ to DB doesn&#39;t know how to connect to our database or which POCOs go with what database. All this mapping is done through a <code>DataConnection</code> class:</p>
<pre><code class="lang-c#">public class DbNorthwind : LinqToDB.Data.DataConnection
{
  public DbNorthwind() : base(&quot;Northwind&quot;) { }

  public ITable&lt;Product&gt; Product =&gt; GetTable&lt;Product&gt;();
  public ITable&lt;Category&gt; Category =&gt; GetTable&lt;Category&gt;();

  // ... other tables ...
}
</code></pre><p>We call the base constructor with the &quot;Northwind&quot; parameter. This parameter (called <code>configuration name</code>) has to match the name=&quot;Northwind&quot; we defined above in our connection string. We also have to register our <code>Product</code> class we defined above to allow us to write LINQ queries.</p>
<p>And now let&#39;s get some data:</p>
<pre><code class="lang-c#">using LinqToDB;
using LinqToDB.Common;

public static List&lt;Product&gt; All()
{
  using (var db = new DbNorthwind())
  {
    var query = from p in db.Product
                where p.ProductID &gt; 25
                orderby p.Name descending
                select p;
    return query.ToList();
  }
}
</code></pre><p>Make sure you <strong>always</strong> wrap your <code>DataConnection</code> class (in our case <code>DbNorthwind</code>) in a <code>using</code> statement. This is required for proper resource management, like releasing the database connections back into the pool. <a href="https://linq2db.github.io/articles/general/Managing-data-connection.html">More details</a></p>
<h2 id="selecting-columns">Selecting Columns</h2>
<p>Most times we get the entire row from the database:</p>
<pre><code class="lang-c#">from p in db.Product
where p.ProductID == 5
select p;
</code></pre><p>However, sometimes getting all the fields is too wasteful so we want only certain fields, but still use our POCOs; something that is challenging for libraries that rely on object tracking, like LINQ to SQL.</p>
<pre><code class="lang-c#">from p in db.Product
orderby p.Name descending
select new Product
{
  Name = p.Name
};
</code></pre><h2 id="composing-queries">Composing queries</h2>
<p>Rather than concatenating strings we can &#39;compose&#39; LINQ expressions.  In the example below the final SQL will be different if <code>onlyActive</code> is true or false, or if <code>searchFor</code> is not null.</p>
<pre><code class="lang-c#">public static List&lt;Product&gt; All(bool onlyActive, string searchFor)
{
  using (var db = new DbNorthwind())
  {
    var products = from p in db.Product 
                   select p;

    if (onlyActive)
    {
      products = from p in products 
                 where !p.Discontinued 
                 select p;
    }

    if (searchFor != null)
    {
      products = from p in products 
                 where p.Name.Contains(searchFor) 
                 select p;
    }

    return products.ToList();
  }
}
</code></pre><h2 id="paging">Paging</h2>
<p>A lot of times we need to write code that returns only a subset of the entire dataset. We expand on the previous example to show what a product search function could look like. </p>
<p>Keep in mind that the code below will query the database twice. Once to find out the total number of records, something that is required by many paging controls, and once to return the actual data.</p>
<pre><code class="lang-c#">public static List&lt;Product&gt; Search(string searchFor, int currentPage, int pageSize, out int totalRecords)
{
  using (var db = new DbNorthwind())
  {
    var products = from p in db.Product 
                   select p;

    if (searchFor != null)
    {
      products = from p in products 
                 where p.Name.Contains(searchFor) 
                 select p;
    }

    totalRecords = products.Count();

    return products.Skip((currentPage - 1) * pageSize).Take(pageSize).ToList();
  }
}
</code></pre><h2 id="joins">Joins</h2>
<p>This assumes we added a <code>Category</code> class, just like we did with the <code>Product</code> class, defined all the fields, and registered it in our <code>DbNorthwind</code> data access class. We can now write an <strong>INNER JOIN</strong> query like this:</p>
<pre><code class="lang-c#">from p in db.Product
join c in db.Category on p.CategoryID equals c.CategoryID
select new Product
{
  Name = p.Name,
  Category = c
};
</code></pre><p>and a <strong>LEFT JOIN</strong> query like this:</p>
<pre><code class="lang-c#">from p in db.Product
from c in db.Category.Where(q =&gt; q.CategoryID == p.CategoryID).DefaultIfEmpty()
select new Product
{
  Name = p.Name,
  Category = c
};
</code></pre><p><a href="https://linq2db.github.io/articles/sql/Join-Operators.html">More samples are here</a></p>
<h2 id="creating-your-pocos">Creating your POCOs</h2>
<p>In the previous example we assign an entire <code>Category</code> object to our product, but what if we want all the fields in our <code>Product</code> class, but we don&#39;t want to specify every field by hand? Unfortunately, we <strong>cannot</strong> write this:</p>
<pre><code class="lang-c#">from p in db.Product
from c in db.Category.Where(q =&gt; q.CategoryID == p.CategoryID).DefaultIfEmpty()
select new Product(c);
</code></pre><p>The query above assumes the Product class has a constructor that takes in a Category object. The query above won&#39;t work, but we <strong>can</strong> work around that with the following query:</p>
<pre><code class="lang-c#">from p in db.Product
from c in db.Category.Where(q =&gt; q.CategoryID == p.CategoryID).DefaultIfEmpty()
select Product.Build(p, c);
</code></pre><p>For this to work, we need a function in the <code>Product</code> class that looks like this:</p>
<pre><code class="lang-c#">public static Product Build(Product product, Category category)
{
  if (product != null)
  {
    product.Category = category;
  }
  return product;
}
</code></pre><p>One caveat with this approach is that if you&#39;re using it with composed queries (see example above) the select Build part has to come only in the final select.</p>
<h2 id="insert">Insert</h2>
<p>At some point we will need to add a new <code>Product</code> to the database. One way would be to call the <code>Insert</code> extension method found in the <code>LinqToDB</code> namespace; so make sure you import that.</p>
<pre><code class="lang-c#">using LinqToDB;

using (var db = new DbNorthwind())
{
  db.Insert(product);
}
</code></pre><p>This inserts all the columns from our Product class, but without retrieving the generated identity value. To do that we can use <code>InsertWith*Identity</code> methods, like this:</p>
<pre><code class="lang-c#">using LinqToDB;

using (var db = new DbNorthwind())
{
  product.ProductID = db.InsertWithInt32Identity(product);
}
</code></pre><p>There is also <code>InsertOrReplace</code> that updates a database record if it was found by primary key or adds it otherwise.</p>
<p>If you need to insert only certain fields, or use values generated by the database, you could write:</p>
<pre><code class="lang-c#">using LinqToDB;

using (var db = new DbNorthwind())
{
  db.Product
    .Value(p =&gt; p.Name, product.Name)
    .Value(p =&gt; p.UnitPrice, 10.2m)
    .Value(p =&gt; p.Added, () =&gt; Sql.CurrentTimestamp)
    .Insert();
}
</code></pre><p>Use of this method also allows us to build insert statements like this:</p>
<pre><code class="lang-c#">using LinqToDB;

using (var db = new DbNorthwind())
{
  var statement = db.Product
                    .Value(p =&gt; p.Name, product.Name)
                    .Value(p =&gt; p.UnitPrice, 10.2m);

  if (storeAdded) statement.Value(p =&gt; p.Added, () =&gt; Sql.CurrentTimestamp);

  statement.Insert();
}
</code></pre><h2 id="update">Update</h2>
<p>Updating records follows similar pattern to Insert. We have an extension method that updates all the columns in the database:</p>
<pre><code class="lang-c#">using LinqToDB;

using (var db = new DbNorthwind())
{
  db.Update(product);
}
</code></pre><p>And we also have a lower level update mechanism:</p>
<pre><code class="lang-c#">using LinqToDB;

using (var db = new DbNorthwind())
{
  db.Product
    .Where(p =&gt; p.ProductID == product.ProductID)
    .Set(p =&gt; p.Name, product.Name)
    .Set(p =&gt; p.UnitPrice, product.UnitPrice)
    .Update();
}
</code></pre><p>Similarly, we can break an update query into multiple pieces if needed:</p>
<pre><code class="lang-c#">using LinqToDB;

using (var db = new DbNorthwind())
{
  var statement = db.Product
                    .Where(p =&gt; p.ProductID == product.ProductID)
                    .Set(p =&gt; p.Name, product.Name);

  if (updatePrice) statement = statement.Set(p =&gt; p.UnitPrice, product.UnitPrice);

  statement.Update();
}
</code></pre><p>You&#39;re not limited to updating a single record. For example, we could discontinue all the products that are no longer in stock:</p>
<pre><code class="lang-c#">using LinqToDB;

using (var db = new DbNorthwind())
{
  db.Product
    .Where(p =&gt; p.UnitsInStock == 0)
    .Set(p =&gt; p.Discontinued, true)
    .Update();
}
</code></pre><h2 id="delete">Delete</h2>
<p>Similar to how you update records, you can also delete records:</p>
<pre><code class="lang-c#">using LinqToDB;

using (var db = new DbNorthwind())
{
  db.Product
    .Where(p =&gt; p.Discontinued)
    .Delete();
}
</code></pre><h2 id="bulk-copy">Bulk Copy</h2>
<p>Bulk copy feature supports the transfer of large amounts of data into a table from another data source. For more details read this <a href="https://linq2db.github.io/articles/sql/Bulk-Copy.html">article</a>.</p>
<pre><code class="lang-c#">using LinqToDB.Data;

[Table(Name = &quot;ProductsTemp&quot;)]
public class ProductTemp
{
  [PrimaryKey]
  public int ProductID { get; set; }

  [Column(Name = &quot;ProductName&quot;), NotNull]
  public string Name { get; set; }

  // ... other columns ...
}

var list = new List&lt;ProductTemp&gt;();
// populate list

using (var db = new DbNorthwind())
{
  db.BulkCopy(list);
}
</code></pre><h2 id="transactions">Transactions</h2>
<p>Using database transactions is easy. All you have to do is call BeginTransaction() on your DataConnection, run one or more queries, and then commit the changes by calling CommitTransaction(). If something happened and you need to roll back your changes you can either call RollbackTransaction() or throw an exception.</p>
<pre><code class="lang-c#">using (var db = new DbNorthwind())
{
  db.BeginTransaction();

  // ... select / insert / update / delete ...

  if (somethingIsNotRight)
  {
    db.RollbackTransaction();
  }
  else
  {
    db.CommitTransaction();
  }
}
</code></pre><p>Also, you can use .NET built-in TransactionScope class:</p>
<pre><code class="lang-c#">// don&#39;t forget that isolation level is serializable by default
using (var transaction = new TransactionScope())
// or for async code
// using (var transaction = new TransactionScope(TransactionScopeAsyncFlowOption.Enabled))
{
  using (var db = new DbNorthwind())
  {
    ...
  }
  transaction.Complete();
}
</code></pre><h2 id="merge">Merge</h2>
<p><a href="https://linq2db.github.io/articles/sql/merge/Merge-API.html">Here</a> you can read about MERGE support.</p>
<h2 id="window-analytic-functions">Window (Analytic) Functions</h2>
<p><a href="https://linq2db.github.io/articles/sql/Window-Functions-%28Analytic-Functions%29.html">Here</a> you can read about Window (Analytic) Functions support.</p>
<h2 id="miniprofiler">MiniProfiler</h2>
<p>If you would like to use <a href="https://github.com/MiniProfiler/dotnet">MiniProfiler</a> or other profiling tool that wraps ADO.NET provider classes, you need to configure our regular DataConnection to use wrapped connection.</p>
<pre><code class="lang-c#">// example of SQL Server-backed data connection with MiniProfiler enabled for debug builds
public class DbDataContext : DataConnection
{
// let&#39;s use profiler only for debug builds
#if !DEBUG
  public DbDataContext() : base(&quot;Northwind&quot;)
  {
    // this is important part:
    // here we tell linq2db how to access underlying ADO.NET classes of used provider
    // if you don&#39;t configure those mappings, linq2db will be unable to use provider-specific functionality
    // which could lead to loss or unavailability of some functionality when profiled connection enabled
    MappingSchema.SetConvertExpression&lt;ProfiledDbConnection,  IDbConnection&gt; (db =&gt; db.WrappedConnection);
    MappingSchema.SetConvertExpression&lt;ProfiledDbDataReader,  IDataReader&gt;   (db =&gt; db.WrappedReader);
    MappingSchema.SetConvertExpression&lt;ProfiledDbTransaction, IDbTransaction&gt;(db =&gt; db.WrappedTransaction);
    MappingSchema.SetConvertExpression&lt;ProfiledDbCommand,     IDbCommand&gt;    (db =&gt; db.InternalCommand);
  }
#else
  public DbDataContext() : base(GetDataProvider(), GetConnection()) { }

  private static IDataProvider GetDataProvider()
  {
     // create provider instance (SQL Server 2012 provider in our case)
     return new SqlServerDataProvider(&quot;&quot;, SqlServerVersion.v2012);
  }

  private static IDbConnection GetConnection()
  {
     // create provider-specific connection instance. SqlConnection in our case
     var dbConnection = new SqlConnection(@&quot;Server=.\SQL;Database=Northwind;Trusted_Connection=True;Enlist=False;&quot;);

     // wrap it by profiler&#39;s connection implementation
     return new StackExchange.Profiling.Data.ProfiledDbConnection(dbConnection, MiniProfiler.Current);
  }
#endif
}
</code></pre><h1 id="more">More</h1>
<p>Still have questions left? Check out our <a href="https://linq2db.github.io">documentation site</a> and <a href="https://linq2db.github.io/articles/FAQ.html">FAQ</a></p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/linq2db/docs/blob/master/source/index.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            Copyright © 2011-2020 linq2db.com<br><br>Generated by <strong>DocFX</strong>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="styles/docfx.js"></script>
    <script type="text/javascript" src="styles/main.js"></script>
  </body>
</html>
